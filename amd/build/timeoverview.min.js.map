{"version":3,"file":"timeoverview.min.js","sources":["../src/timeoverview.js"],"sourcesContent":["import Templates from 'core/templates';\nimport Widget from 'lytix_helper/widget';\nimport PercentRounder from 'lytix_helper/percent_rounder';\n\n/**\n * Main function for this module.\n * @param {number} contextid\n * @param {number} courseid\n * @param {string} containerid\n */\nexport const init = (contextid, courseid, containerid) => {\n\n    const WIDGET_ID = containerid ?? 'timeoverview';\n\n    const dataPromise = Widget.getData(\n        'local_lytix_lytix_timeoverview_timeoverview_get',\n        {contextid: contextid, courseid: courseid}\n    )\n    .then(data => {\n        const\n            activities = data.Activities,\n            length = activities.length;\n        for (let i = 0; i < length; ++i) {\n            if (activities[i].MedianTime > 0) {\n                return data;\n            }\n        }\n        throw new Widget.NoDataError();\n    });\n\n    // XXX: The indeces have to match!\n    const stringsPromise = Widget.getStrings({\n        lytix_timeoverview: { // eslint-disable-line camelcase\n            differing: {\n                Resource: 'timeoverview_label_resource',\n                Video: 'timeoverview_label_video',\n                Forum: 'timeoverview_label_forum',\n                Course: 'timeoverview_label_core',\n                Quiz: 'timeoverview_label_quiz',\n                Grade: 'timeoverview_label_grade',\n                Submission: 'timeoverview_label_submission',\n                Feedback: 'timeoverview_label_feedback',\n                description: 'timeoverview_description',\n            },\n        }\n    });\n\n    Promise.all([stringsPromise, dataPromise])\n    .then(values => {\n        const\n            strings = values[0],\n            data = values[1];\n\n        const activities = data.Activities;\n\n        const view = {\n            description: {text: strings.description},\n            data: [],\n        };\n\n        const\n            length = activities.length,\n            rounder = new PercentRounder();\n        for (let i = 0; i < length; ++i) {\n            const activity = activities[i];\n\n            if (activity.MedianTime <= 0) {\n                continue;\n            }\n\n            view.data.push({\n                activity: activity.Type.toLowerCase(),\n                label: strings[activity.Type],\n                percent: rounder.round(activity.MedianTime * 100),\n            });\n        }\n\n        return Templates.render('lytix_timeoverview/timeoverview', view);\n    })\n    .then(html => {\n        Widget.getContentContainer(WIDGET_ID).insertAdjacentHTML('beforeend', html);\n        return;\n    })\n    .finally(() => {\n        document.getElementById(WIDGET_ID).classList.remove('loading');\n    })\n    .catch(error => Widget.handleError(error, WIDGET_ID));\n};\n"],"names":["contextid","courseid","containerid","WIDGET_ID","dataPromise","Widget","getData","then","data","activities","Activities","length","i","MedianTime","NoDataError","stringsPromise","getStrings","lytix_timeoverview","differing","Resource","Video","Forum","Course","Quiz","Grade","Submission","Feedback","description","Promise","all","values","strings","view","text","rounder","PercentRounder","activity","push","Type","toLowerCase","label","percent","round","Templates","render","html","getContentContainer","insertAdjacentHTML","finally","document","getElementById","classList","remove","catch","error","handleError"],"mappings":"gfAUoB,SAACA,UAAWC,SAAUC,iBAEhCC,UAAYD,MAAAA,YAAAA,YAAe,eAE3BE,YAAcC,gBAAOC,QACvB,kDACA,CAACN,UAAWA,UAAWC,SAAUA,WAEpCM,MAAK,SAAAC,cAEEC,WAAaD,KAAKE,WAClBC,OAASF,WAAWE,OACfC,EAAI,EAAGA,EAAID,SAAUC,KACtBH,WAAWG,GAAGC,WAAa,SACpBL,WAGT,IAAIH,gBAAOS,eAIfC,eAAiBV,gBAAOW,WAAW,CACrCC,mBAAoB,CAChBC,UAAW,CACPC,SAAU,8BACVC,MAAO,2BACPC,MAAO,2BACPC,OAAQ,0BACRC,KAAM,0BACNC,MAAO,2BACPC,WAAY,gCACZC,SAAU,8BACVC,YAAa,+BAKzBC,QAAQC,IAAI,CAACd,eAAgBX,cAC5BG,MAAK,SAAAuB,gBAEEC,QAAUD,OAAO,GAGfrB,WAFKqB,OAAO,GAEMpB,WAElBsB,KAAO,CACTL,YAAa,CAACM,KAAMF,QAAQJ,aAC5BnB,KAAM,IAING,OAASF,WAAWE,OACpBuB,QAAU,IAAIC,yBACTvB,EAAI,EAAGA,EAAID,SAAUC,EAAG,KACvBwB,SAAW3B,WAAWG,GAExBwB,SAASvB,YAAc,GAI3BmB,KAAKxB,KAAK6B,KAAK,CACXD,SAAUA,SAASE,KAAKC,cACxBC,MAAOT,QAAQK,SAASE,MACxBG,QAASP,QAAQQ,MAA4B,IAAtBN,SAASvB,qBAIjC8B,mBAAUC,OAAO,kCAAmCZ,SAE9DzB,MAAK,SAAAsC,sBACKC,oBAAoB3C,WAAW4C,mBAAmB,YAAaF,SAGzEG,SAAQ,WACLC,SAASC,eAAe/C,WAAWgD,UAAUC,OAAO,cAEvDC,OAAM,SAAAC,cAASjD,gBAAOkD,YAAYD,MAAOnD"}